<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LocalStorage</title>
    <style>
input, label{
    margin-bottom: 10px;
}

button{
    background-color: rgb(43, 212, 43);
    color: white;
    
}

div{
    border: 1px black solid;
    padding: 20px;
    border-radius: 12px;
    margin-top: 10px;
}

#searchTable {
    border-collapse: collapse;
    width: 100%;
    margin-top: 10px;
    display: none;
}

#searchTable th, #searchTable td {
    border: 1px solid #ccc;
    padding: 6px 8px;
}

#searchTable th {
    background: #f5f5f5;
    text-align: left;
}

.btn-edit {
    background: #5bc0de;
    color: white;
    border: none;
    padding: 3px 8px;
    cursor: pointer;
    margin-right: 4px;
}

.btn-delete {
    background: #d9534f;
    color: white;
    border: none;
    padding: 3px 8px;
    cursor: pointer;
}

    </style>
</head>
<body>

    <h1>HDK6NX Hallgatók</h1>

    <div>

        <h2>Új hallgató hozzáadása</h2>

        <label for="name">Név:</label>
        <input type="text" class="name" id="name" name="name"> <br>
        <label for="evfoly">Évfolyam:</label>
        <input type="text" class="evfoly" id="evfoly" name="evfoly"> <br>
        <label for="szak">Szak:</label>
        <input type="text" class="szak" id="szak" name="szak" placeholder="PTI"> <br>
        <label for="email">Email:</label>
        <input type="email" class="email" id="email", name="email" placeholder="pti@pti.hu"> <br>
        <label for="neptunk">NEPTUN kód:</label>
        <input type="text" class="neptunk" id="neptunk", name="neptunk" placeholder="AAA-123"> <br>

        <button onclick="mentes()" >Mentés</button>
    </div>

<div>
<div>
    <h3>Keresés</h3>
    <input type="text"
           id="searchInput"
           placeholder="Keresés név / szak / email / NEPTUN szerint"
           oninput="doSearch()">

    <table id="searchTable">
        <thead>
            <tr>
                <th>Név</th>
                <th>Évfolyam</th>
                <th>Szak</th>
                <th>Email</th>
                <th>NEPTUN</th>
                <th>Műveletek</th>
            </tr>
        </thead>
        <tbody id="searchBody">
        </tbody>
    </table>
</div>


    <h3>Rendezés</h3>
    <select id="rend" name="rend" required>
        <option value="" disabled selected>Nincs rendezés</option>
        <option value="name">Név</option>
        <option value="evfoly">Évfolyam</option>
    </select>


<br><br>
    <label for="expimp"><b>Export / Import JSON</b></label>
    
    <button type="button" onclick="exportJSON()">Export JSON</button>

    <input type="file" id="importFile" accept="application/json" style="display:none"
        onchange="importJSON(event)">

    <button type="button" onclick="document.getElementById('importFile').click()">
        Import JSON
    </button>
    


</div>

<script>
    function getHallgatok() {
        const stored = localStorage.getItem('hallgatok');
        if (!stored) {
            return [];
        }
        try {
            return JSON.parse(stored);
        } catch (e) {
            console.error('Hibás JSON a localStorage-ben:', e);
            return [];
        }
    }

    function saveHallgatok(hallgatok) {
        localStorage.setItem('hallgatok', JSON.stringify(hallgatok));
    }

    function mentes() {
    const hallgatok = getHallgatok();

    const ujHallgato = {
        name:      document.getElementById('name').value,
        evfolyam:  document.getElementById('evfoly').value,
        szak:      document.getElementById('szak').value,
        email:     document.getElementById('email').value,
        neptunkod: document.getElementById('neptunk').value
    };

    const out = document.getElementById('kimenet');
    if (out) {
        out.textContent =
            'Hallgató elmentve! Jelenlegi lista:\n\n' +
            JSON.stringify(hallgatok, null, 4);
    }

    document.getElementById('name').value = '';
    document.getElementById('evfoly').value = '';
    document.getElementById('szak').value = '';
    document.getElementById('email').value = '';
    document.getElementById('neptunk').value = '';

    hallgatok.push(ujHallgato);
    saveHallgatok(hallgatok);
    listazas();
}

    document.getElementById("myForm").addEventListener("submit", function (e) {
        e.preventDefault();
    
        const formData = new FormData(e.target);
        let obj = {};
    
        formData.forEach((value, key) => obj[key] = value);
    
        const jsonString = JSON.stringify(obj, null, 2);
    
        const blob = new Blob([jsonString], { type: "application/json" });
        const url = URL.createObjectURL(blob);
    
        const a = document.createElement("a");
        a.href = url;
        a.download = "adatok.json";
        a.click();
    
        URL.revokeObjectURL(url);
    });
    
    document.getElementById("jsonFileInput").addEventListener("change", function (e) {
        const file = e.target.files[0];
        if (!file) return;
    
        const reader = new FileReader();
        reader.onload = function(event) {
            try {
                const data = JSON.parse(event.target.result);
    
                const form = document.getElementById("myForm");
    
                Object.keys(data).forEach(key => {
                    if (form.elements[key]) {
                        form.elements[key].value = data[key];
                    }
                });
    
                alert("JSON sikeresen importálva!");
    
            } catch (err) {
                alert("Hibás JSON fájl!");
            }
        };
    
        reader.readAsText(file);
    });

    document.getElementById("searchInput").addEventListener("keydown", function(e) {
    if (e.key === "Enter") {
       e.preventDefault();
        doSearch();
    }
});

function doSearch() {
    const query = document.getElementById("searchInput").value.trim().toLowerCase();
    const table = document.getElementById("searchTable");
    const tbody = document.getElementById("searchBody");

    if (query === "") {
        table.style.display = "none";
        tbody.innerHTML = "";
        return;
    }

    const hallgatok = getHallgatok();

    const talalatok = hallgatok.filter(h => {
        const combined =
            (h.name || "") + " " +
            (h.evfolyam || "") + " " +
            (h.szak || "") + " " +
            (h.email || "") + " " +
            (h.neptunkod || "");
        return combined.toLowerCase().includes(query);
    });

    tbody.innerHTML = "";
    talalatok.forEach((h, index) => {
        const tr = document.createElement("tr");

        tr.innerHTML = `
            <td>${h.name || ""}</td>
            <td>${h.evfolyam || ""}</td>
            <td>${h.szak || ""}</td>
            <td>${h.email || ""}</td>
            <td>${h.neptunkod || ""}</td>
            <td>
                <button class="btn-edit" onclick="modositHallgato('${h.neptunkod}')">Módosít</button>
                <button class="btn-delete" onclick="torolHallgato('${h.neptunkod}')">Töröl</button>
            </td>
        `;

        tbody.appendChild(tr);
    });

    table.style.display = talalatok.length > 0 ? "table" : "none";
}

function modositHallgato(neptun) {
    const hallgatok = getHallgatok();
    const index = hallgatok.findIndex(h => h.neptunkod === neptun);
    if (index === -1) {
        alert("Nem található a hallgató (NEPTUN: " + neptun + ")");
        return;
    }

    const h = hallgatok[index];

    document.getElementById('name').value    = h.name || "";
    document.getElementById('evfoly').value  = h.evfolyam || "";
    document.getElementById('szak').value    = h.szak || "";
    document.getElementById('email').value   = h.email || "";
    document.getElementById('neptunk').value = h.neptunkod || "";

    editingIndex = index;

    const saveBtn = document.querySelector('button[onclick="mentes()"]');
    if (saveBtn) saveBtn.textContent = "Módosítás mentése";
}

function torolHallgato(neptun) {
    if (!confirm("Biztos törlöd? (" + neptun + ")")) return;

    let hallgatok = getHallgatok();
    hallgatok = hallgatok.filter(h => h.neptunkod !== neptun);
    saveHallgatok(hallgatok);

    doSearch();
    listazas && listazas();
}



function exportJSON() {
    const hallgatok = getHallgatok();
    const jsonString = JSON.stringify(hallgatok, null, 2);

    const blob = new Blob([jsonString], { type: "application/json" });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "hallgatok.json";
    a.click();

    URL.revokeObjectURL(url);
}


function importJSON(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const data = JSON.parse(e.target.result);

            if (!Array.isArray(data)) {
                alert("A JSON-ben egy tömbnek (hallgatók listájának) kell lennie!");
                return;
            }

            saveHallgatok(data);

            document.getElementById('kimenet').textContent =
                'JSON sikeresen importálva! Jelenlegi lista:\n\n' +
                JSON.stringify(data, null, 4);

        } catch (err) {
            console.error(err);
            alert("Hibás JSON fájl: " + err.message);
        }
    };

    reader.readAsText(file);
    event.target.value = "";
}
    </script>

</body>


</html>